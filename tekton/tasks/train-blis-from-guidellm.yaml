apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: train-blis-from-guidellm
spec:
  description: |
    Delete model engines
  
  workspaces:
    - name: data

  params:
    - name: results_dir
      type: string
  
  steps:
    - name: placeholder
      image: python:3.12.9-slim-bookworm
      script: |
        #!/bin/sh
        set -eu
        echo "train-preprocess called"

        echo "ðŸ”„ Installing required tools"
        apt-get update
        apt-get install -y \
          git \
          && apt-get clean && rm -rf /var/cache/apt

        git clone -b scenario5 https://github.com/inference-sim/vllm-data-collection.git
        cd vllm-data-collection
        pip install -r requirements.txt
        
        RESULTS_DIR="$(workspaces.data.path)/$(params.results_dir)"
        TRACES="$RESULTS_DIR/traces.json"

        python train_blis.py --traces "$TRACES_RESULTS" --results_path "$RESULTS_DIR"

